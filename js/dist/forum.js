(()=>{var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var r=e.n(t);const a=flarum.core.compat["common/extend"],o=flarum.core.compat["common/components/TextEditor"];var s=e.n(o);r().initializers.add("jerrymalmstrom-paste-image",function(){(0,a.extend)(s().prototype,"oncreate",function(e,t){var a=this,o=this.element.querySelector("textarea");o&&(this.pasteImageHandler=function(e){var t=e.clipboardData&&e.clipboardData.items;if(t){for(var s=null,n=0;n<t.length;n++)if(0===t[n].type.indexOf("image/")){s=t[n];break}if(s){e.preventDefault();var i=s.getAsFile();if(i){var m="![Uploading...]()";a.attrs.composer.editor.insertAtCursor(m),o.classList.add("paste-image-uploading");var p=new FormData;p.append("paste-image",i),r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/paste-image/upload",serialize:function(e){return e},body:p}).then(function(e){var t="![image]("+e.url+")",r=a.attrs.composer.editor.getContents();a.attrs.composer.editor.setContents(r.replace(m,t)),o.classList.remove("paste-image-uploading")}).catch(function(e){var t=a.attrs.composer.editor.getContents();a.attrs.composer.editor.setContents(t.replace(m,"")),o.classList.remove("paste-image-uploading"),r().alerts.show({type:"error"},r().translator.trans("jerrymalmstrom-paste-image.forum.upload_error"))})}}}},o.addEventListener("paste",this.pasteImageHandler))}),(0,a.extend)(s().prototype,"onremove",function(){if(this.pasteImageHandler){var e=this.element&&this.element.querySelector("textarea");e&&e.removeEventListener("paste",this.pasteImageHandler)}})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map