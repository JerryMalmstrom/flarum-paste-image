(()=>{var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var a=e.n(t);const r=flarum.core.compat["common/extend"],o=flarum.core.compat["common/components/TextEditor"];var n=e.n(o);a().initializers.add("jerrymalmstrom-paste-image",function(){(0,r.extend)(n().prototype,"oncreate",function(e,t){var r=this,o=this.element.querySelector("textarea");o&&(this.pasteImageHandler=function(e){var t=e.clipboardData&&e.clipboardData.items;if(t){for(var n=null,s=0;s<t.length;s++)if(0===t[s].type.indexOf("image/")){n=t[s];break}if(n){e.preventDefault();var i=n.getAsFile();if(i){var m=r.attrs.composer.editor,p="![uploading-"+Date.now()+"]()";m.insertAtCursor(p),o.classList.add("paste-image-uploading");var l=new FormData;l.append("paste-image",i),fetch(a().forum.attribute("apiUrl")+"/paste-image/upload",{method:"POST",headers:{"X-CSRF-Token":a().session.csrfToken},body:l}).then(function(e){if(!e.ok)throw new Error(e.statusText);return e.json()}).then(function(e){var t="![]("+e.url+")",a=m.getContents();m.setContents(a.replace(p,t)),o.classList.remove("paste-image-uploading")}).catch(function(){var e=m.getContents();m.setContents(e.replace(p,"")),o.classList.remove("paste-image-uploading"),a().alerts.show({type:"error"},a().translator.trans("jerrymalmstrom-paste-image.forum.upload_error"))})}}}},o.addEventListener("paste",this.pasteImageHandler))}),(0,r.extend)(n().prototype,"onremove",function(){if(this.pasteImageHandler){var e=this.element&&this.element.querySelector("textarea");e&&e.removeEventListener("paste",this.pasteImageHandler)}})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map